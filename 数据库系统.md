# 数据库系统

## 三级模式-两级映射

模式

+ 外模式-用户级数据库-用户视图

+ 概念模式-概念级数据库-DBA数据库

+ 内模式-物理级数据库-内部视图

映射

+ 外模式-概念模式映射

+ 概念模式-内模式映射

## 设计流程

+ 需求分析
  
  + 数据流图
  
  + 数据字典
  
  + 需求说明书

+ 概念结构设计
  
  + ER模型

+ 逻辑结构设计
  
  + 转换规则、规范化理论
  
  + 关系模式

+ 物理设计
  
  + DBMS特征
  
  + 硬件、OS特性

## ER模型

 图示

+ 方框-实体

+ 椭圆-属性

+ 菱形-联系

ER模型转关系模式

+ 一个实体模型转换为一个关系模式
  
  + 1:1
    
    + 联系可以转换成一个关系模式，也可以放入与之关联的任意一个实体中
  
  + 1:n
    
    + 联系可以转换成一个关系模式，也可以放入与之关联的、多的实体中
  
  + m:n
    
    + 联系必须转换成一个关系模式

+ 三个以上实体间的一个多元联系

## 关系代数

运算类型

+ 并 相同内容只显示一次

+ 交 找出公共部分

+ 差 S1-S2，S1有但S2没有

+ 笛卡尔积

+ 投影 选列

+ 选择 选行

+ 联接 都有的字段只保留一个
  
  + 没有写条件就是自然联接，也就是相同的字段做等值

## 规范化理论

函数依赖

+ 部分函数依赖
  
  + 主键是组合键，主键中的一部分可以确定非主属性

+ 传递依赖

价值与用途

非规范化的关系范式，可能存在的问题包括

+ 数据冗余

+ 更新异常

+ 插入异常

+ 删除异常

键

+ 超键 唯一标识元祖

+ 候选键 超键消除多余属性

+ 主键 候选键任选一个

+ 外键 其他关系的主键

范式

+ 1NF
  
  + 属性值都是不可分的原子值

+ 2NF
  
  + 消除非主属性对候选键的部分依赖

+ 3NF
  
  + 消除非主属性对候选键的传递依赖

+ BCNF
  
  + 消除主属性对候选键的传递依赖
  + 把函数依赖全部写出，依赖的左边必须全部是候选键

模式分解

+ 保持函数依赖分解

+ 无损分解

## 并发控制

+ 一级封锁协议
  
  + 事务T在修改数据R之前必须对其加X锁，直到事务结束才释放。可防止丢失修改

+ 二级封锁协议

+ 三级封锁协议

+ 两段锁协议

## 完整性约束

+ 实体完整性
  
  + 主键不能重复，也不能空

+ 参照完整性
  
  + 外键

+ 用户自定义完整性

+ 触发器
  
  + 使用脚本执行复杂的约束

## 数据库安全

+ 用户标识和鉴定-使用用户账户、口令及随机数验证

+ 存取控制- 对用户授权

+ 密码存储和传输-对远程终端信息加密传输

+ 视图的保护-对视图进行授权

+ 审计-使用一个专门文件或数据库，自动将用户的所有操作记录下来

## 数据备份

+ 冷备份-静态备份
  
  + 在停止条件下进行备份
  
  + 简单、速度快、维护技术少、不易出问题
  
  + 备份时用户无法使用

+ 热备份-动态备份
  
  + 可在表级别备份、秒级恢复、恢复很快

依据量备份

+ 完全备份

+ 差量备份
  
  + 仅备份上一次完全备份之后变化的数据

+ 增量备份
  
  + 备份上一次备份之后变化的数据
  
  + 速度快，但恢复慢

| 故障关系        | 故障原因        | 解决方法                        |
| ----------- | ----------- | --------------------------- |
| 事务本身的可预期故障  | 本身逻辑        | 预设置RollBack                 |
| 事务本身的不可预期故障 | 算术溢出、违反存储保护 | 由DBMS的恢复子系统通过日志，撤销事务对数据库的修改 |
| 系统故障        | 系统停止运转      | 检查点法                        |
| 介质故障        | 外存被破坏       | 使用日志重做业务                    |

## 数据仓库与数据挖掘

数据仓库

+ 面向主题

+ 集成的

+ 相对稳定

+ 反映历史变化

## 反规范化

为提示查询的速度，牺牲规范化和空间。技术手段

+ 增加派生性冗余列

+ 增加冗余列

+ 重新组表

+ 分割表
